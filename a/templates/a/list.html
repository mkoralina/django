<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <!--ajax-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">


    {% load staticfiles %}
    <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" media="screen">
    <style type="text/css">
    /*calosc stylow*/

    .btn-room {
        width: 7em;
    }

    td {
        padding: 10px;
    }

    </style>

    <title>{% block title %}Main</title>{% endblock%}

    <!--{% load staticfiles %}
    <script type="text/javascript" src="{% static 'jquery.js' %}"></script> -->
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    {% load staticfiles %}
    <script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>
    <script src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-tooltip.js"></script>

    <!--
<script type="text/javascript">
function ajaxFunction()
{
var xmlhttp;
if (window.XMLHttpRequest)
  {
  // code for IE7+, Firefox, Chrome, Opera, Safari
  xmlhttp=new XMLHttpRequest();
  }
else if (window.ActiveXObject)
  {
  // code for IE6, IE5
  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
else
  {
  alert("Your browser does not support XMLHTTP!");
  }
}
</script>




-->






</head>

<body>


{% if messages %}
    <ul>
        {% for message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
    </ul>
    <hr><br>
{% endif %}




<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
      </div>
      <div id="modalContent" class="modal-body"> <!-- TUTAJ LADUJ TRESC AJAXEM -->
        <p>One fine body&hellip;</p>


  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
          Data 3 z godzinami Item #3
        </a>
      </h4>
    </div>
    <div id="collapseThree" class="panel-collapse collapse">
      <div class="panel-body">
Lista godzin:
<br> godzina 1
          <br> godzina 2
          <br> godzina 3

      </div>
    </div>
  </div>
</div>





      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<div id='loadingmessage' style='display:none'>
       <img src="{% static 'ajax-loader.gif' %}"/>
</div>

<div class="main_div">
<table align="center">
<tr>
    <td>
    Rooms with their capacities: <br><br>
<table border="0">
    <tr><td><b>Room</b></td>
        <td><b>Capacity</b></td>
    </tr>

    {% for room in queryset %}

    <tr><td>
        <button id="{{room.id}}" class="btn btn-primary btn-lg btn-room" data-toggle="modal" data-target="#myModal"> <!-- onclick="$('#modalContent').html('http://students.mimuw.edu.pl/~mk334666/sudoku.html');">
        <!--
        <button id=room.id class="btn btn-primary btn-lg btn-room" data-toggle="modal" data-target="#myModal" onclick="alert('kliknales');">
        -->
            <!--<a href="{% url 'a:detail' room.id%}">pokoj</a>-->
        {{ room.name }}
        </button>
    </td>
        <td>{{room.capacity}}</td>
    </tr>
    {% endfor %}
</table>

<div class="pagination">
    <span class="step-links">
        {% if queryset.has_previous %}
            <a href="?page={{ queryset.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ queryset.number }} of {{ queryset.paginator.num_pages }}.
        </span>

        {% if queryset.has_next %}
            <a href="?page={{ queryset.next_page_number }}">next</a>
        {% endif %}
    </span>
</div>
        </td>
    <td align="right">

<form action="{% url 'a:list' %}" id="form_order" method="POST">
    {% csrf_token %}
    Search
    <input type="text" name="keyword">
    in description or name. <br>
    Capacity from:
    <input type="number" name="min_capacity">
    to:
    <input type="number" name="max_capacity">
    <br>

    <br>
    Required equipment:<br>
    <input type="checkbox" name="projector"> Projector<br>
    <input type="checkbox" name="whiteboard"> Whiteboard<br>
    <input type="checkbox" name="blackboard"> Blackboard<br>
    <input type="checkbox" name="scanner"> Scanner<br>
    <input type="checkbox" name="printer"> Printer<br>

<input type="submit" class="btn btn-large" value="Search">
    <br><br><br>


</form>

<select name="order" form="form_order" onchange="this.form.submit()">
    <option value="'0'">Choose order of display</option>
    <option value="alph">A-Z</option>
    <option value="alph_inv">Z-A</option>
    <option value="cap">by capacity ascending</option>
    <option value="cap_inv">by capacity descending</option>
</select><br><br>


</td>
    </tr></table>





</div>

<br><br>

<hr>
{% block content %}
    <a href="{% url 'a:list' %}">Go back to the beginning of the search</a>
{% endblock %}


{% if user.is_authenticated %}
    <p>You are logged in as: {{ user.username }}<br>
       <a href="{% url 'a:logout' %}">Log out</a></p>
{% endif %}







<!-- skrypt z Ciebiery -->
<script>
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

var csrftoken = getCookie('csrftoken');

function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}
function sameOrigin(url) {
    // test that a given url is a same-origin URL
    // url could be relative or scheme relative or absolute
    var host = document.location.host; // host + port
    var protocol = document.location.protocol;
    var sr_origin = '//' + host;
    var origin = protocol + sr_origin;
    // Allow absolute or scheme relative URLs to same origin
    return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
        (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
        // or any other URL that isn't scheme relative or absolute i.e relative.
        !(/^(\/\/|http:|https:).*/.test(url));
}
$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && sameOrigin(settings.url)) {
            // Send the token to same-origin, relative URLs only.
            // Send the token only if the method warrants CSRF protection
            // Using the CSRFToken value acquired earlier
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
    }
});

$(".btn-room").click(function() {
        id = $(this).attr('id')

        url = "/a/" + id + "/"
       // alert("wybrales sale " + $(this).attr('id') + "adres http:// : " + url)

        $('#loadingmessage').show();

        var jqxhr = $.ajax(url, {type:"GET",
            data: {'room_id': id} } )
        .done(function(data) {
            console.log( "success" );
            $("#modalContent").html(data);
            $('#loadingmessage').hide();
            })
        .fail(function() {
            console.log( "error" );
            })
        .always(function() {
            console.log( "complete" );
            });
        });



    </script>

<!-- koniec skryptu z Ciebiery-->


<script>
    var r;
    var e;

function odbierzDane()
{
  if (r.readyState == 4) {
    if (r.status == 200 || r.status == 304) {
      e.innerHTML = r.responseText;
    }
  }
}

function setContent(adresurl, htmlid)
{
  if (r = getXMLHttpRequest()) {
    e = document.getElementById(htmlid);
    r.open('GET', adresurl);
    r.onreadystatechange = odbierzDane;
    r.send(null);
  }
}

</script>







</body>
</html>